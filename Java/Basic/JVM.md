# JVM

JVM은 **Java Virtual Machine**을 줄인 것으로 자바를 실행하기 위한 가상 기계라고 할 수 잇다.

<img width="493" alt="스크린샷 2022-08-03 오전 12 50 23" src="https://user-images.githubusercontent.com/97823928/182417642-2ecc5ac5-79a1-4c36-8cce-c88a4642a5e0.png">


* 일반 애플리케이션의 코드는 OS만 거치고 하드웨어로 전달되는 반면, 자바 애플리케이션은 JVM을 한번 더 거친다.
* 일반 애플리케이션은 OS와 바로 맞붙어 있으므로 OS에 종속적이며, 다른 운영체제에서 실행시키기 위해서는 애플리케이션을 그 OS에 맞게 변경해야한다. 
* 반면 자바 애플리케이션은 JVM하고만 상호작용하므로 OS와 하드웨어에 독립적이라 다른 OS에서도 프로그램의 변경없이 실행이 가능하다. (어느 OS이든 상관없이 컴파일된 코드가 플랫폼 독립적)
* 단, JVM은 운영체제에 종속적이므로 해당 OS에 실행가능한 JVM이 존재해야한다.

# JVM의 구조

JVM의 구조는 크게 보면, ```Garbage Collector```, ```Execution Engine```, ```Class Loader```, ```Runtime Data Area``` 4가지로 나눌 수 있다.

## 1. Class Loader

JVM 내로 클래스를 로드하고 링크(2~4)를 통해 배치하는 작업을 수행하는 모듈로 런타임시 **동적으로 클래스를 로드**한다.

1. ```Loading``` : 클래스 파일을 가져와서 JVM의 메모리에 로드한다.
2. ```Verifying``` : 읽어온 클래스의 바이너리 데이터가 유효한지 확인한다. (.class 파일 데이터인 경우에 진행)
3. ```Preparing``` : 클래스가 필요로 하는 메모리를 할당
4. ```Resolving``` : 클래스의 상수 풀 내 모든 심볼릭 레퍼런스를 메소드 영역의 실제 힙 메모리 영역에 있는 인스턴스에 대한 레퍼런스로 교체한다.
5. ```Initializing``` : 클래스 변수들을 적절한 값으로 초기화한다.
 

## 2. Execution Engine

클래스 로더를 통해 JVM 내의 Runtime Data Area에 배치된 바이트 코드들을 명렁어 단위로 읽어서 실행한다.   
이 때, Execution Engine은 자바 바이트 코드를 명령어 단위로 읽어서 실행한다.

## 3. Garbage Collector

JVM은 Garbage Collector를 통해 메모리 관리 기능을 자동으로 수행한다.  
힙 메모리 영역에 생성된 객체들 중에서 참조되지 않은 객체들을 탐색 후 제거하는 방식으로 메모리를 자동 관리한다.

## 4. Runtime Data Area

VM이 운영체제 위에서 실행되면서 할당받는 메모리 영역이다. Class Loader에서 준비한 데이터들을 보관하는 저장소이다.

### (1) Method Area 

* 프로그램 실행 중 어떤 클래스가 사용되면 JVM은 해당 클래스의 클래스파일(*.class)을 읽고 분석하여 클래스에 대한 정보를 이곳에 저장한다.
* 이 영역에 런타임 상수 풀, 멤버 변수(필드), 클래스 변수(Static 변수), 생성자와 메소드를 저장한다.

### (2) Heap Area
* 인스턴스가 생성되는 공간 → New 연산자로 생성된 객체를 저장한다.
* 참조하는 변수나 필드가 없다면 GC의 대상이 된다.

### (3) Call Stack
* 호출스택은 메서드의 작업에 필요한 메모리 공간을 할당한다.
* 메서드가 호출되면 수행에 필요한 만큼의 메모리를 스택에 할당받는다.
* 메서드가 수행을 마치면 사용했던 메모리를 반환하고 스택에서 제거된다.
* 호출스택의 제일 위에 있는 메서드는 현재 실행 중인 메서드이며, 아래에 있는 메서드가 바로 위의 메서드를 호출한 메서드이다. 

### (4) PC Register

* 스레드가 시작될 때 생성되며 각 스레드마다 하나씩 존재한다. 
* 현재 수행중인 JVM 명령의 주소를 가진다.

### (5) Native Method Stack Area

* 자바 외 언어로 작성된 네이티브 코드를 위한 메모리 영역이다.

## 참고자료
* https://steady-snail.tistory.com/67
* https://hoonmaro.tistory.com/19
